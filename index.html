<!-- RUNTIME SKELETON (EN) -->
<style>
body{margin:0;background:#0b1020;color:#e8ecf4;font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial}
.stage{min-height:100vh;display:flex;align-items:center;justify-content:center}
.phone{width:360px;height:640px;border-radius:28px;box-shadow:0 20px 60px rgba(0,0,0,.35);overflow:hidden;border:1px solid rgba(255,255,255,.08);background:#0f152a}
@media (max-width:420px){.phone{width:320px;height:568px}}

/* status bar (preview-only) */
.status{height:26px;display:flex;align-items:center;justify-content:space-between;padding:0 10px;
font-size:12px;color:#aeb7c8;background:linear-gradient(0deg,rgba(255,255,255,.06),rgba(255,255,255,.09))}
.status .dots{display:flex;gap:4px}
.status .dot{width:6px;height:6px;border-radius:50%;background:#aeb7c8;opacity:.85}
.wrap{padding:16px}
.card{background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.08);border-radius:16px;padding:16px}
.h1{font-size:22px;font-weight:800;margin:0 0 6px}
.p{margin:0 0 10px;color:#9aa3b2}
.btn{appearance:none;border:0;border-radius:12px;padding:12px 14px;font-weight:800;cursor:pointer}
.btn-primary{background:linear-gradient(90deg,#34d399,#10b981);color:#062d24}
.badge{display:inline-block;padding:4px 8px;border-radius:999px;background:#1d243d;border:1px solid rgba(255,255,255,.08);font-size:12px;color:#9aa3b2;margin-bottom:10px}
</style>

<!-- Infinite UX extra classes -->
<style id="infinite-ux">
/* ××¦×‘×™ ×¦×‘×¢ ×œ×›×¤×ª×•×¨ (××¢×‘×¨ ×‘×™×Ÿ ×©×œ×‘×™×) */
.btn.alt1{background:#7c3aed;color:#fff}
.btn.alt2{background:#0ea5e9;color:#fff}
.btn.success{background:#10b981;color:#fff}

/* ××¤×§×˜×™× ×¢×“×™× ×™× ×œ×¨×§×¢ ×”×›×¨×˜×™×¡ */
.wrap.fx-alert{animation:infFlashRed .8s ease-in-out 2 alternate}
@keyframes infFlashRed{0%{background:#0f1218}100%{background:#241112}}
.wrap.fx-calm{animation:infCalm .8s ease forwards}
@keyframes infCalm{from{background:#241112}to{background:#0f1218}}
.wrap.fx-blue{animation:infBlue .7s ease-in-out 2 alternate}
@keyframes infBlue{0%{box-shadow:0 0 0 0 rgba(0,144,255,.10)}100%{box-shadow:0 0 0 14px rgba(0,144,255,.08)}}
.wrap.fx-pink{animation:infPink .7s ease-in-out 2 alternate}
@keyframes infPink{0%{box-shadow:0 0 0 0 rgba(238,0,120,.10)}100%{box-shadow:0 0 0 14px rgba(238,0,120,.08)}}

/* ×§×•× ×¤×˜×™ "×¤×•×£" ×©××›×¡×” ××ª ×›×œ ×”×•×•×¤×•×¨×˜ (××‘×œ × ×©××¨ ×‘×ª×•×š #app) */
.confetti-fixed{pointer-events:none;position:fixed;inset:0;z-index:999;overflow:hidden}
.confetti-fixed span{position:absolute;top:-20px;font-size:20px;animation:infFall 1.8s linear forwards}
@keyframes infFall{to{transform:translateY(110vh) rotate(240deg);opacity:.95}}
</style>

<div class="stage">
<div id="phone" class="phone">
<!-- ×™×•×–×¨ ×××™×ª×™ ×œ× ×™×¨××” ××ª ×”×¡×˜×˜×•×¡Ö¾×‘×¨; ××•×¦×’ ×¨×§ ×›×©preview=1 -->
<div id="status" class="status" style="display:none">
<div>9:41</div>
<div class="dots"><span class="dot"></span><span class="dot"></span><span class="dot"></span></div>
</div>
<div class="wrap"><div id="app" class="card"></div></div>
</div>
</div>

<script>
(function(){
const qs = new URLSearchParams(location.search);
const F = (qs.get('f')||'').trim(); // feature slug
const NAME = (qs.get('name')||'Friend').trim();
const GIFT = (qs.get('giftUrl')||'#').trim();
const PREV = (qs.get('preview')||'0').trim()==='1';
function getCopy(key, fallback) {
  const v = qs.get(key);
  if (!v || v.trim().length === 0) return fallback;
  return v.trim().slice(0, 80);
}
function sfx(kind){
  try{
    const ctx = new (window.AudioContext || window.webkitAudioContext)();
    const o = ctx.createOscillator(), g = ctx.createGain();
    const now = ctx.currentTime, freq = { error:180, whoosh:420, tada:880, confirm:520 }[kind] || 600;
    o.type='sine'; o.frequency.setValueAtTime(freq, now);
    g.gain.setValueAtTime(0.0001, now);
    g.gain.exponentialRampToValueAtTime(0.2, now + 0.02);
    g.gain.exponentialRampToValueAtTime(0.0001, now + 0.15);
    o.connect(g); g.connect(ctx.destination); o.start(); o.stop(now + 0.16);
  }catch(e){}
}

// ×”×¦×’ ×¡×˜×˜×•×¡Ö¾×‘×¨ ×¨×§ ×‘×¤×¨×™×‘×™×•
if (PREV) document.getElementById('status').style.display = 'flex';

function el(html){ document.getElementById('app').innerHTML = html; }

// ===== Voice Verify (placeholder ×¢×“ ×œ××™××•×©) =====
function voiceVerify(){
el(`
<div class="badge">Voice Verify â€“ demo</div>
<h1 class="h1">${NAME}, a special gift is waiting! ğŸ</h1>
<p class="p">Fun verification challenge.</p>
<button class="btn btn-primary">Verify & get the gift</button>
<p class="p" style="margin-top:12px">Gift link (hidden in real flow): <a href="${GIFT}" target="_blank">${GIFT}</a></p>
`);
}

// ===== Fake Captcha =====
function captcha(){
el(`
<div class="badge">Fake Captcha â€“ demo</div>
<h1 class="h1">Are you a human, ${NAME}? ğŸ¤–</h1>
<p class="p">Please solve this silly puzzleâ€¦</p>
<button class="btn btn-primary">I'm human</button>
`);
}

// ===== Infinite Buttons =====
function infinite(){
  const app = document.getElementById('app');

  // Read params
  const NAME = getCopy('name', 'Friend');
  const GIFT = qs.get('giftUrl') || 'https://example.com';
  const ACCENT = (qs.get('accent') || 'dark').toLowerCase();
  const titleOverride = qs.get('title');

  const copy = {
    title: titleOverride ? titleOverride : `ğŸ’– ${NAME} ğŸ’–`,
    subtitle: getCopy('subtitle', 'Ready for a tiny surprise?'),
    btn1_loading: getCopy('btn1_loading', 'Checking your surpriseâ€¦'),
    btn2_error: getCopy('btn2_error', 'Oops! Try again'),
    btn3_tease1: getCopy('btn3_tease1', 'Hmmâ€¦ almost ğŸ˜‰'),
    btn4_tease2: getCopy('btn4_tease2', 'Keep goingâ€¦'),
    btn5_tease3: getCopy('btn5_tease3', 'Patience, hero!'),
    btn6_tease4: getCopy('btn6_tease4', 'So closeâ€¦'),
    btn7_tease5: getCopy('btn7_tease5', 'Last one!'),
    btn8_success: getCopy('btn8_success', 'Unlocked! Tap to open'),
    earned: getCopy('earned', 'You earned it ğŸ‰')
  };

  // Base shell (with optional preview chrome)
  const shell = document.createElement('div');
  const themeClass = (ACCENT==='purple'?'theme-purple': ACCENT==='sky'?'theme-sky': ACCENT==='green'?'theme-green':'theme-dark');
  shell.className = themeClass;

  // Inner block (reused for both preview + live)
  const inner = document.createElement('div');
  inner.className = 'wrap';
  inner.innerHTML = `
    <h1>${copy.title}</h1>
    <p class="sub">${copy.subtitle}</p>
    <button id="ibtn" class="btn">${copy.btn1_loading}</button>
    <div id="iprogress" class="progress" aria-hidden="true"><div class="progress__bar" id="ibar"></div></div>
    <span id="itext" class="progress__text" aria-live="polite" aria-atomic="true" style="display:none">0%</span>
    <div id="earned" class="earned">${copy.earned}</div>
  `;
  
  app.replaceChildren(inner);
  }

  // Interaction logic
  const btn = document.getElementById('ibtn');
  const bar = document.getElementById('ibar');
  const progWrap = document.getElementById('iprogress');
  const ptxt = document.getElementById('itext');
  const earned = document.getElementById('earned');
  
// helpers for fun states
function resetBtnColors(){
  btn.classList.remove('error','purple','sky','green','alt1','alt2','success');
}
function resetFx(){
  inner.classList.remove('flash-red','shake'); // ××”×§×™×™×
  inner.classList.remove('fx-alert','fx-calm','fx-blue','fx-pink'); // ××”×—×“×©×™×
}
  
  let tap = 0;            // 0 before any tap; user tap increments
  let loading = true;     // We start in "loading" state (after first tap label)
  let success = false;

  // Initialize visual state for Step 1 loading
  progWrap.style.display = 'block';
  ptxt.style.display = 'block';
  ptxt.textContent = '0%';
  btn.disabled = false;

  // Start loading animation only on first click (per brief: Tap #1 â†’ loading ~4s)
  let interval = null;
  let progress = 0;

  function startLoading(){
    loading = true;
    btn.disabled = true;
    sfx('confirm');
    interval = setInterval(()=>{
      progress = Math.min(100, progress + Math.floor(Math.random()*7)+2);
      bar.style.width = progress + '%';
      ptxt.textContent = progress + '%';
      if (progress >= 100){
        clearInterval(interval);
        setTimeout(()=>{
          btn.disabled = false;
          loading = false;
          // After loading finishes, user must tap again to move to step 2
        }, 350);
      }
    }, 120);
  }

  function openGift(){
    try { window.open(GIFT, '_blank', 'noopener'); } catch(e) {}
  }

  btn.addEventListener('click', function(){
    // If success already achieved, every tap opens gift immediately
    if (success) { openGift(); return; }

    if (tap === 0){
      // First user tap should start loading if not started
      if (!interval) startLoading();
      tap = 1;
      return;
    }
    if (loading) return; // ignore taps during loading

    tap++; // Move to next stage after loading

    // Stage routing (2..8)
    switch (tap) {
      case 2: {
  btn.textContent = copy.btn2_error;
  resetBtnColors(); btn.classList.add('error'); sfx('error');
  resetFx(); inner.classList.add('flash-red','shake','fx-alert');
  setTimeout(()=>{ inner.classList.remove('flash-red','shake'); }, 550);
  break;
}
      case 3: { btn.textContent = copy.btn3_tease1; resetBtnColors(); btn.classList.add('alt1'); resetFx(); break; }
      case 4: { btn.textContent = copy.btn4_tease2; resetBtnColors(); btn.classList.add('alt2'); resetFx(); inner.classList.add('fx-calm'); break; }
      case 5: { btn.textContent = copy.btn5_tease3; resetBtnColors(); btn.classList.add('alt1'); resetFx(); inner.classList.add('fx-blue'); sfx('whoosh'); break; }
      case 6: { btn.textContent = copy.btn6_tease4; resetBtnColors(); btn.classList.add('alt2'); resetFx(); break; }
      case 7: { btn.textContent = copy.btn7_tease5; resetBtnColors(); btn.classList.add('alt1'); resetFx(); inner.classList.add('fx-pink'); sfx('whoosh'); break; }
      case 8: {
  btn.textContent = copy.btn8_success;
  resetBtnColors(); btn.classList.add('success'); // ×™×¨×•×§ × ×¢×™×
  resetFx(); earned.classList.add('show');

  // ×§×•× ×¤×˜×™ "×¤×•×£": ×”×¨×‘×” ×—×œ×§×™×§×™×, ××©×›×™ ×–××Ÿ ×©×•× ×™×, ××›×¡×” ××¡×š â€” ××‘×œ × ×©××¨ ×‘×ª×•×š #app
  const conf = document.createElement('div');
  conf.className = 'confetti-fixed';
  const EMOJI = ['ğŸ‰','âœ¨','ğŸŠ','ğŸ’¥','ğŸŸ¡','ğŸŸ£','ğŸŸ¢'];
  for (let i=0;i<90;i++){
    const s = document.createElement('span');
    s.textContent = EMOJI[(Math.random()*EMOJI.length)|0];
    s.style.left = (Math.random()*100)+'vw';
    s.style.animationDelay = (Math.random()*0.5)+'s';
    s.style.animationDuration = (1.6 + Math.random()*0.6)+'s'; // 1.6â€“2.2s
    conf.appendChild(s);
  }
  // ×”×•×¡×£ ×œ-#app (fixed â†’ ××›×¡×” ×•×•×¤×•×¨×˜), ×”×¡×¨×” ××•×˜×•××˜×™×ª
  app.appendChild(conf);
  setTimeout(()=> conf.remove(), 2600);

  sfx('tada');
  success = true;
  break;
}
      default: {
        // Any extra taps after 8 â†’ open immediately
        openGift();
      }
    }
  }, false);
}

// ===== Narcissist Questions =====
function narcissistQ(){
el(`
<div class="badge">Narcissist Q â€“ demo</div>
<h1 class="h1">Quick personality check for ${NAME}</h1>
<p class="p">Answer a few oddly self-centric questionsâ€¦</p>
<button class="btn btn-primary">Start</button>
`);
}

// ===== Selfie Verify =====
function selfieVerify(){
el(`
<div class="badge">Selfie Verify â€“ demo</div>
<h1 class="h1">${NAME}, snap a quick selfie ğŸ“¸</h1>
<p class="p">This is a demo screen. Real flow will ask for permissions.</p>
<button class="btn btn-primary">Open camera</button>
`);
}

const map = {
'voice-verify': voiceVerify,
'captcha': captcha,
'infinite': infinite,
'narcissist-q': narcissistQ,
'selfie-verify': selfieVerify
};

(map[F] || (()=>el('<h1 class="h1">Feature not found</h1><p class="p">Use ?f=voice-verify|captcha|infinite|narcissist-q|selfie-verify</p>')))();
})();
</script>
