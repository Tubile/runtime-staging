<!-- RUNTIME SKELETON (EN) -->
<style>
body{margin:0;background:#0b1020;color:#e8ecf4;font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial}
.progress{margin-top:10px;height:8px;background:rgba(255,255,255,.06);border-radius:999px;overflow:hidden;border:1px solid rgba(255,255,255,.08)}
.progress__bar{height:100%;width:0%;background:linear-gradient(90deg,#60a5fa,#a78bfa);transition:width .08s linear}
.sub{margin:0 0 12px;color:#9aa3b2;font-size:14px}
.stage{min-height:100vh;display:flex;align-items:center;justify-content:center}
.phone{width:360px;height:640px;border-radius:28px;box-shadow:0 20px 60px rgba(0,0,0,.35);overflow:hidden;border:1px solid rgba(255,255,255,.08);background:#0f152a}
@media (max-width:420px){.phone{width:320px;height:568px}}

/* status bar (preview-only) */
.status{height:26px;display:flex;align-items:center;justify-content:space-between;padding:0 10px;
font-size:12px;color:#aeb7c8;background:linear-gradient(0deg,rgba(255,255,255,.06),rgba(255,255,255,.09))}
.status .dots{display:flex;gap:4px}
.status .dot{width:6px;height:6px;border-radius:50%;background:#aeb7c8;opacity:.85}
.wrap{padding:16px}
.card{background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.08);border-radius:16px;padding:16px}
.h1{font-size:22px;font-weight:800;margin:0 0 6px}
.p{margin:0 0 10px;color:#9aa3b2}
.btn{appearance:none;border:0;border-radius:12px;padding:12px 14px;font-weight:800;cursor:pointer}
.btn-primary{background:linear-gradient(90deg,#34d399,#10b981);color:#062d24}
.badge{display:inline-block;padding:4px 8px;border-radius:999px;background:#1d243d;border:1px solid rgba(255,255,255,.08);font-size:12px;color:#9aa3b2;margin-bottom:10px}
/* Infinite: inline percent inside the button + canvas confetti */
.btn{position:relative}
.btn .label{pointer-events:none}
.btn .percent{position:absolute; right:14px; top:50%; transform:translateY(-50%); font-size:12px; opacity:.9}

/* earned is hidden by default */
.earned{display:none}

/* gentle shake */
@keyframes infShake{10%,90%{transform:translateX(-1px)}20%,80%{transform:translateX(2px)}30%,50%,70%{transform:translateX(-4px)}40%,60%{transform:translateX(4px)}}
.shake{animation:infShake .35s linear 1}

/* confetti canvas */
.confetti-canvas{position:fixed; inset:0; pointer-events:none; z-index:999}
.confetti-canvas{ width:100vw; height:100vh }
</style>

<!-- Infinite UX extra classes -->
<style id="infinite-ux">
/* ××¦×‘×™ ×¦×‘×¢ ×œ×›×¤×ª×•×¨ (××¢×‘×¨ ×‘×™×Ÿ ×©×œ×‘×™×) */
.btn.alt1{background:#7c3aed;color:#fff}
.btn.alt2{background:#0ea5e9;color:#fff}
.btn.success{background:#10b981;color:#fff}

/* ××¤×§×˜×™× ×¢×“×™× ×™× ×œ×¨×§×¢ ×”×›×¨×˜×™×¡ */
.wrap.fx-alert{animation:infFlashRed .8s ease-in-out 2 alternate}
@keyframes infFlashRed{0%{background:#0f1218}100%{background:#241112}}
.wrap.fx-calm{animation:infCalm .8s ease forwards}
@keyframes infCalm{from{background:#241112}to{background:#0f1218}}
.wrap.fx-blue{animation:infBlue .7s ease-in-out 2 alternate}
@keyframes infBlue{0%{box-shadow:0 0 0 0 rgba(0,144,255,.10)}100%{box-shadow:0 0 0 14px rgba(0,144,255,.08)}}
.wrap.fx-pink{animation:infPink .7s ease-in-out 2 alternate}
@keyframes infPink{0%{box-shadow:0 0 0 0 rgba(238,0,120,.10)}100%{box-shadow:0 0 0 14px rgba(238,0,120,.08)}}

/* ×§×•× ×¤×˜×™ "×¤×•×£" ×©××›×¡×” ××ª ×›×œ ×”×•×•×¤×•×¨×˜ (××‘×œ × ×©××¨ ×‘×ª×•×š #app) */
.confetti-fixed{pointer-events:none;position:fixed;inset:0;z-index:999;overflow:hidden}
.confetti-fixed span{position:absolute;top:-20px;font-size:20px;animation:infFall 1.8s linear forwards}
@keyframes infFall{to{transform:translateY(110vh) rotate(240deg);opacity:.95}}
/* Infinite-only layout & sizing */
.wrap-infinite{
  display:grid;
  gap:16px;              /* ×¨×™×•×•×— × ×¢×™× ×‘×™×Ÿ ×›×œ ×”××œ×× ×˜×™× */
  justify-items:center;  /* ××¨×›×– ×”×›×œ ××•×¤×§×™×ª */
  text-align:center;     /* ×˜×§×¡×˜ ×××•×¨×›×– */
}
.wrap-infinite h1{ margin:0; font-size:26px; line-height:1.25 }
.wrap-infinite .sub{ margin:0; font-size:15px; opacity:.9 }

/* ×›×¤×ª×•×¨ ×’×“×•×œ ×•×××™×Ÿ (××—×™×“ ×œ×›×œ ×”××¦×‘×™×) */
.wrap-infinite .btn{
  width:min(320px, 100%);
  min-height:48px;
  padding:14px 18px;
  font-size:16px;
  border-radius:16px;
  font-weight:800;
  margin:0 auto;
}

/* ×‘×¨Ö¾×”×ª×§×“××•×ª ××™×•×©×¨ ×œ×¨×•×—×‘ ×”×›×¤×ª×•×¨ */
.wrap-infinite .progress{ width:min(320px, 100%); margin-top:2px }

/* earned â€“ ×§×¦×ª ×¨×•×•×— ××¢×œ */
.wrap-infinite .earned{ margin-top:8px }
</style>

<div class="stage">
<div id="phone" class="phone">
<!-- ×™×•×–×¨ ×××™×ª×™ ×œ× ×™×¨××” ××ª ×”×¡×˜×˜×•×¡Ö¾×‘×¨; ××•×¦×’ ×¨×§ ×›×©preview=1 -->
<div id="status" class="status" style="display:none">
<div>9:41</div>
<div class="dots"><span class="dot"></span><span class="dot"></span><span class="dot"></span></div>
</div>
<div class="wrap"><div id="app" class="card"></div></div>
</div>
</div>

<script>
(function(){
const qs = new URLSearchParams(location.search);
const F = (qs.get('f')||'').trim(); // feature slug
const NAME = (qs.get('name')||'Friend').trim();
const GIFT = (qs.get('giftUrl')||'#').trim();
const PREV = (qs.get('preview')||'0').trim()==='1';
function getCopy(key, fallback) {
  const v = qs.get(key);
  if (!v || v.trim().length === 0) return fallback;
  return v.trim().slice(0, 80);
}
function sfx(kind){
  try{
    const ctx = new (window.AudioContext || window.webkitAudioContext)();
    const o = ctx.createOscillator(), g = ctx.createGain();
    const now = ctx.currentTime, freq = { error:180, whoosh:420, tada:880, confirm:520 }[kind] || 600;
    o.type='sine'; o.frequency.setValueAtTime(freq, now);
    g.gain.setValueAtTime(0.0001, now);
    g.gain.exponentialRampToValueAtTime(0.2, now + 0.02);
    g.gain.exponentialRampToValueAtTime(0.0001, now + 0.15);
    o.connect(g); g.connect(ctx.destination); o.start(); o.stop(now + 0.16);
  }catch(e){}
}

// ×”×¦×’ ×¡×˜×˜×•×¡Ö¾×‘×¨ ×¨×§ ×‘×¤×¨×™×‘×™×•
if (PREV) document.getElementById('status').style.display = 'flex';

function el(html){ document.getElementById('app').innerHTML = html; }

// ===== Voice Verify (placeholder ×¢×“ ×œ××™××•×©) =====
function voiceVerify(){
el(`
<div class="badge">Voice Verify â€“ demo</div>
<h1 class="h1">${NAME}, a special gift is waiting! ğŸ</h1>
<p class="p">Fun verification challenge.</p>
<button class="btn btn-primary">Verify & get the gift</button>
<p class="p" style="margin-top:12px">Gift link (hidden in real flow): <a href="${GIFT}" target="_blank">${GIFT}</a></p>
`);
}

// ===== Fake Captcha =====
function captcha(){
el(`
<div class="badge">Fake Captcha â€“ demo</div>
<h1 class="h1">Are you a human, ${NAME}? ğŸ¤–</h1>
<p class="p">Please solve this silly puzzleâ€¦</p>
<button class="btn btn-primary">I'm human</button>
`);
}

// ===== Infinite Buttons =====
function infinite(){
  const app = document.getElementById('app');

  // Read params
  const NAME = getCopy('name', 'Friend');
  const GIFT = qs.get('giftUrl') || 'https://example.com';
  const ACCENT = (qs.get('accent') || 'dark').toLowerCase();
  const titleOverride = qs.get('title');

  const copy = {
    title: titleOverride ? titleOverride : `${NAME}, you've got a sweet surprise! ğŸ’–`,
    subtitle: getCopy('subtitle', 'Click the button to get your gift'),
    btn1_loading: getCopy('btn1_loading', 'Checking your surpriseâ€¦'),
    btn2_error: getCopy('btn2_error', 'Oops! Try again'),
    btn3_tease1: getCopy('btn3_tease1', 'Hmmâ€¦ almost ğŸ˜‰'),
    btn4_tease2: getCopy('btn4_tease2', 'Keep goingâ€¦'),
    btn5_tease3: getCopy('btn5_tease3', 'Patience, hero!'),
    btn6_tease4: getCopy('btn6_tease4', 'So closeâ€¦'),
    btn7_tease5: getCopy('btn7_tease5', 'Last one!'),
    btn8_success: getCopy('btn8_success', 'Unlocked! Tap to open'),
    earned: getCopy('earned', 'You earned it ğŸ‰')
  };

  // Inner block
  const inner = document.createElement('div');
  inner.className = 'wrap wrap-infinite';
  inner.innerHTML = `
    <h1>${copy.title}</h1>
    <p class="sub">${copy.subtitle}</p>

    <button id="ibtn" class="btn">
      <span id="ilabel" class="label">${getCopy('btn0_start','Click to get your gift')}</span>
      <span id="ipct" class="percent" style="display:none">0%</span>
    </button>

    <div id="iprogress" class="progress" aria-hidden="true" style="display:none">
      <div class="progress__bar" id="ibar"></div>
    </div>

    <div id="earned" class="earned">${copy.earned}</div>
    <canvas id="confetti" class="confetti-canvas"></canvas>
  `;
  app.replaceChildren(inner);
  document.getElementById('app').classList.remove('card');

  // Refs
  const btn = document.getElementById('ibtn');
  const ilabel = document.getElementById('ilabel');
  const ipct = document.getElementById('ipct');
  const bar = document.getElementById('ibar');
  const progWrap = document.getElementById('iprogress');
  const earned = document.getElementById('earned');
  const confettiCanvas = document.getElementById('confetti');

  // helpers for fun states
  function resetBtnColors(){
    btn.classList.remove('error','purple','sky','green','alt1','alt2','success');
  }
  function resetFx(){
    inner.classList.remove('shake','fx-alert','fx-calm','fx-blue','fx-pink');
  }

  // state
  let tap = 0;
  let loading = false;
  let success = false;
  btn.disabled = false;
  let interval = null;

  function startLoading(){
    loading = true;
    btn.disabled = true;
    sfx('confirm');

    progWrap.style.display = 'block';
    ipct.style.display = 'inline';
    ipct.textContent = '0%';
    bar.style.width = '0%';

    let p = 0;
    interval = setInterval(()=>{
      p = Math.min(100, p + Math.floor(Math.random()*7)+2);
      bar.style.width = p + '%';
      ipct.textContent = p + '%';

      if (p >= 100){
        clearInterval(interval);
        setTimeout(()=>{
  ipct.style.display = 'none';
  btn.disabled = false;
  loading = false;
  // ××¢×‘×¨ ××•×˜×•××˜×™ ×œ×©×œ×‘ ×”×‘× (Oops) ×‘×œ×™ ×§×œ×™×§ × ×•×¡×£
  if (tap === 1) { btn.click(); }
}, 300);
      }
    }, 120);
  }

  function openGift(){
    try { window.open(GIFT, '_blank', 'noopener'); } catch(e) {}
  }

  btn.addEventListener('click', function(){
    if (success) { openGift(); return; }

    if (tap === 0){
      ilabel.textContent = copy.btn1_loading;
      if (!interval) startLoading();
      tap = 1;
      return;
    }
    if (loading) return;

    tap++;

    switch (tap) {
      case 2: {
        ilabel.textContent = copy.btn2_error;
        resetBtnColors(); btn.classList.add('error'); sfx('error');
        inner.classList.add('shake'); setTimeout(()=> inner.classList.remove('shake'), 300);
        break;
      }
      case 3: { ilabel.textContent = copy.btn3_tease1; resetBtnColors(); btn.classList.add('alt1'); resetFx(); break; }
      case 4: { ilabel.textContent = copy.btn4_tease2; resetBtnColors(); btn.classList.add('alt2'); resetFx(); inner.classList.add('fx-calm'); break; }
      case 5: { ilabel.textContent = copy.btn5_tease3; resetBtnColors(); btn.classList.add('alt1'); resetFx(); inner.classList.add('fx-blue'); sfx('whoosh'); break; }
      case 6: { ilabel.textContent = copy.btn6_tease4; resetBtnColors(); btn.classList.add('alt2'); resetFx(); break; }
      case 7: { ilabel.textContent = copy.btn7_tease5; resetBtnColors(); btn.classList.add('alt1'); resetFx(); inner.classList.add('fx-pink'); sfx('whoosh'); break; }
      case 8: {
        ilabel.textContent = copy.btn8_success;
        resetBtnColors(); btn.classList.add('green'); // ××• .success ×× ×”×•×¡×¤×ª CSS
        earned.classList.add('show');
        confettiBurst(confettiCanvas);
        sfx('tada');
        success = true;
        break;
      }
      default: {
        openGift();
      }
    }
  }, false);

  // Canvas confetti (modern "poof")
  function confettiBurst(canvas){
    if (!canvas) return;
    const ctx = canvas.getContext('2d');
    const r = window.devicePixelRatio || 1;
    function size(){ canvas.width = canvas.clientWidth * r; canvas.height = canvas.clientHeight * r; ctx.setTransform(r,0,0,r,0,0); }
    if (!canvas.__sized){ canvas.__sized = true; canvas.style.display='block'; size(); window.addEventListener('resize', size); }
    const colors = ['#a78bfa','#60a5fa','#34d399','#f472b6','#f59e0b'];
    const pieces = [];
    const w = canvas.clientWidth, h = canvas.clientHeight;
    for(let i=0;i<120;i++){
      pieces.push({ x:w/2, y:h/2, vx:(Math.random()*4-2), vy:(Math.random()*-3-2),
        r:Math.random()*6+3, c:colors[(Math.random()*colors.length)|0], a:1, spin:(Math.random()*6.28), vr:(Math.random()*0.2-0.1) });
    }
    const g = 0.05; let t=0;
    (function step(){
      ctx.clearRect(0,0,w,h);
      pieces.forEach(p=>{
        p.vy += g; p.x += p.vx; p.y += p.vy; p.spin += p.vr; p.a -= 0.008;
        ctx.globalAlpha = Math.max(p.a,0);
        ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(p.spin);
        ctx.fillStyle = p.c; ctx.fillRect(-p.r/2,-p.r/2,p.r,p.r);
        ctx.restore();
      });
      ctx.globalAlpha = 1;
      if(t++<260) requestAnimationFrame(step); else ctx.clearRect(0,0,w,h);
    })();
  }
}
// ===== Narcissist Questions =====
function narcissistQ(){
el(`
<div class="badge">Narcissist Q â€“ demo</div>
<h1 class="h1">Quick personality check for ${NAME}</h1>
<p class="p">Answer a few oddly self-centric questionsâ€¦</p>
<button class="btn btn-primary">Start</button>
`);
}

// ===== Selfie Verify =====
function selfieVerify(){
el(`
<div class="badge">Selfie Verify â€“ demo</div>
<h1 class="h1">${NAME}, snap a quick selfie ğŸ“¸</h1>
<p class="p">This is a demo screen. Real flow will ask for permissions.</p>
<button class="btn btn-primary">Open camera</button>
`);
}

const map = {
'voice-verify': voiceVerify,
'captcha': captcha,
'infinite': infinite,
'narcissist-q': narcissistQ,
'selfie-verify': selfieVerify
};

(map[F] || (()=>el('<h1 class="h1">Feature not found</h1><p class="p">Use ?f=voice-verify|captcha|infinite|narcissist-q|selfie-verify</p>')))();
})();
</script>
