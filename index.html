<!-- RUNTIME SKELETON (EN) -->
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<style>
body{margin:0;background:#0b1020;color:#e8ecf4;font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial}
.progress{margin-top:10px;height:8px;background:rgba(255,255,255,.06);border-radius:999px;overflow:hidden;border:1px solid rgba(255,255,255,.08)}
.progress__bar{height:100%;width:0%;background:linear-gradient(90deg,#60a5fa,#a78bfa);transition:width .08s linear}
.sub{margin:0 0 12px;color:#9aa3b2;font-size:14px}
.stage{min-height:100vh;display:flex;align-items:center;justify-content:center}
.phone{
  width:min(420px, 92vw);
  height:calc(min(420px, 92vw) * 1.78); /* ×™×—×¡ × ×¢×™× ~16:9 */
  border-radius:28px;
  box-shadow:0 20px 60px rgba(0,0,0,.35);
  overflow:hidden;
  border:1px solid rgba(255,255,255,.08);
  background:#0f152a;
}
@media (max-width: 480px){
  .stage{ min-height:100svh; align-items:stretch; justify-content:stretch; }
  .phone{ width:100vw; height:100svh; border-radius:0; border:0; box-shadow:none; }
  .wrap{ padding:clamp(16px,4vw,24px); }
}
@media (max-width:420px){
  .phone{ height:calc(92vw * 1.78) }
}

/* status bar (preview-only) */
.status{height:26px;display:flex;align-items:center;justify-content:space-between;padding:0 10px;
font-size:12px;color:#aeb7c8;background:linear-gradient(0deg,rgba(255,255,255,.06),rgba(255,255,255,.09))}
.status .dots{display:flex;gap:4px}
.status .dot{width:6px;height:6px;border-radius:50%;background:#aeb7c8;opacity:.85}
.wrap{padding:16px}
.card{background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.08);border-radius:16px;padding:16px}
.h1{font-size:22px;font-weight:800;margin:0 0 6px}
.p{margin:0 0 10px;color:#9aa3b2}
.btn{appearance:none;border:0;border-radius:12px;padding:12px 14px;font-weight:800;cursor:pointer}
.btn-primary{background:linear-gradient(90deg,#34d399,#10b981);color:#062d24}
.badge{display:inline-block;padding:4px 8px;border-radius:999px;background:#1d243d;border:1px solid rgba(255,255,255,.08);font-size:12px;color:#9aa3b2;margin-bottom:10px}
/* Infinite: inline percent inside the button + canvas confetti */
.btn{position:relative}
.btn .label{pointer-events:none}
.btn .percent{position:absolute; right:14px; top:50%; transform:translateY(-50%); font-size:12px; opacity:.9}

/* earned is hidden by default */
.earned{display:none}

/* gentle shake */
@keyframes infShake{10%,90%{transform:translateX(-1px)}20%,80%{transform:translateX(2px)}30%,50%,70%{transform:translateX(-4px)}40%,60%{transform:translateX(4px)}}
.shake{animation:infShake .35s linear 1}

/* confetti canvas */
.confetti-canvas{position:fixed; inset:0; pointer-events:none; z-index:999}
.confetti-canvas{ width:100vw; height:100vh }
</style>

<!-- Infinite UX extra classes -->
<style id="infinite-ux">
/* ××¦×‘×™ ×¦×‘×¢ ×œ×›×¤×ª×•×¨ (××¢×‘×¨ ×‘×™×Ÿ ×©×œ×‘×™×) */
.btn.alt1{background:#7c3aed;color:#fff}
.btn.alt2{background:#0ea5e9;color:#fff}
.btn.success{background:#10b981;color:#fff}

/* ××¤×§×˜×™× ×¢×“×™× ×™× ×œ×¨×§×¢ ×”×›×¨×˜×™×¡ */
.wrap.fx-alert{animation:infFlashRed .8s ease-in-out 2 alternate}
@keyframes infFlashRed{0%{background:#0f1218}100%{background:#241112}}
.wrap.fx-calm{animation:infCalm .8s ease forwards}
@keyframes infCalm{from{background:#241112}to{background:#0f1218}}
.wrap.fx-blue{animation:infBlue .7s ease-in-out 2 alternate}
@keyframes infBlue{0%{box-shadow:0 0 0 0 rgba(0,144,255,.10)}100%{box-shadow:0 0 0 14px rgba(0,144,255,.08)}}
.wrap.fx-pink{animation:infPink .7s ease-in-out 2 alternate}
@keyframes infPink{0%{box-shadow:0 0 0 0 rgba(238,0,120,.10)}100%{box-shadow:0 0 0 14px rgba(238,0,120,.08)}}

/* ×§×•× ×¤×˜×™ "×¤×•×£" ×©××›×¡×” ××ª ×›×œ ×”×•×•×¤×•×¨×˜ (××‘×œ × ×©××¨ ×‘×ª×•×š #app) */
.confetti-fixed{pointer-events:none;position:fixed;inset:0;z-index:999;overflow:hidden}
.confetti-fixed span{position:absolute;top:-20px;font-size:20px;animation:infFall 1.8s linear forwards}
@keyframes infFall{to{transform:translateY(110vh) rotate(240deg);opacity:.95}}
/* Infinite-only layout & sizing */
.wrap-infinite{
  display:grid;
  gap:16px;              /* ×¨×™×•×•×— × ×¢×™× ×‘×™×Ÿ ×›×œ ×”××œ×× ×˜×™× */
  justify-items:center;  /* ××¨×›×– ×”×›×œ ××•×¤×§×™×ª */
  text-align:center;     /* ×˜×§×¡×˜ ×××•×¨×›×– */
  margin-top: clamp(12px, 6vh, 48px);
}
.wrap-infinite h1{ margin:0; font-size:26px; line-height:1.25 }
.wrap-infinite .sub{ margin:0; font-size:15px; opacity:.9 }

/* ×›×¤×ª×•×¨ ×’×“×•×œ ×•×××™×Ÿ (××—×™×“ ×œ×›×œ ×”××¦×‘×™×) */
.wrap-infinite .btn{
  width:min(320px, 100%);
  min-height:48px;
  padding:14px 18px;
  font-size:16px;
  border-radius:16px;
  font-weight:800;
  margin:0 auto;
}

/* ×‘×¨Ö¾×”×ª×§×“××•×ª ××™×•×©×¨ ×œ×¨×•×—×‘ ×”×›×¤×ª×•×¨ */
.wrap-infinite .progress{ width:min(320px, 100%); margin-top:2px }

/* earned â€“ ×§×¦×ª ×¨×•×•×— ××¢×œ */
.wrap-infinite .earned{ margin-top:8px }
  
/* ×›×¤×ª×•×¨ ×”×¦×œ×—×” ×™×¨×•×§ */
.btn.green{ background:#10b981; color:#fff }
</style>

<!-- CAPTCHA UX styles -->
<style id="captcha-ux">
  .wrap-captcha{
    display:grid; gap:16px; justify-items:center; text-align:center;
    margin-top:clamp(24px, 12vh, 96px);
  }
  .cap-title{ margin:0; font-size:26px; line-height:1.25; font-weight:800 }
  .cap-sub{ margin:0; font-size:15px; color:#9aa3b2 }
  .cap-grid{
    display:grid; grid-template-columns:repeat(3,minmax(0,1fr)); gap:8px;
    width:min(360px, 100%);
  }
  .cap-tile{
    position:relative; aspect-ratio:1/1; border-radius:12px; overflow:hidden;
    border:1px solid rgba(255,255,255,.10); background:#12182b; cursor:pointer;
    transition:transform .04s ease, box-shadow .12s ease;
  }
  .cap-tile{
  /* ×—×“×©: ×˜××¦' ××™×™×“×™ ×•×‘×œ×™ ×”×™×™×œ×™×™×˜ */
  touch-action: manipulation;
  -webkit-tap-highlight-color: transparent;
  user-select: none;
  will-change: transform; /* ×¨××– ×œ×’×¨×¤×™×§×”: ×”××¦×‘ ×”×•×œ×š ×œ×”×©×ª× ×•×ª - ×—×œ×§ ×™×•×ª×¨ */
}
.cap-img{
  pointer-events: none;   /* × ×’×™×¢×” ×ª××™×“ "×ª×•×¤×¡×ª" ××ª ×”×¨×™×‘×•×¢, ×œ× ××ª ×”×ª××•× ×” */
  -webkit-user-drag: none;
  user-select: none;
}
  .cap-tile:hover{ transform:translateY(-1px); box-shadow:0 8px 20px rgba(0,0,0,.25) }
  .cap-img{ position:absolute; inset:0; width:100%; height:100%; object-fit:cover }
  .cap-filler{ position:absolute; inset:0; display:flex; align-items:center; justify-content:center;
    font-size:34px; filter:saturate(1.1); background:linear-gradient(135deg,#0f152a,#141a32) }
  .cap-tile.sel::after{
    content:"âœ“"; position:absolute; right:8px; top:6px; font-weight:900; font-size:16px;
    background:#10b981; color:#062d24; border-radius:999px; padding:2px 6px;
    box-shadow:0 2px 10px rgba(0,0,0,.25);
  }
  .cap-cta{ width:min(320px, 100%); min-height:48px; padding:14px 18px; font-size:16px;
    border-radius:16px; font-weight:800; margin:0 auto }
  .cap-cta.error{ animation:infShake .35s linear 1 }
  .cap-cta.green{ background:#10b981; color:#fff }
  .cap-hint{ font-size:12px; color:#9aa3b2 }
</style>

<div class="stage">
<div id="phone" class="phone">
<!-- ×™×•×–×¨ ×××™×ª×™ ×œ× ×™×¨××” ××ª ×”×¡×˜×˜×•×¡Ö¾×‘×¨; ××•×¦×’ ×¨×§ ×›×©preview=1 -->
<div id="status" class="status" style="display:none">
<div>9:41</div>
<div class="dots"><span class="dot"></span><span class="dot"></span><span class="dot"></span></div>
</div>
<div class="wrap"><div id="app" class="card"></div></div>
</div>
</div>

<script>
(function(){
const qs = new URLSearchParams(location.search);
const F = (qs.get('f')||'').trim(); // feature slug
const NAME = (qs.get('name')||'Friend').trim();
const GIFT = (qs.get('giftUrl')||'#').trim();
const PREV = (qs.get('preview')||'0').trim()==='1';
function getCopy(key, fallback) {
  const v = qs.get(key);
  if (!v || v.trim().length === 0) return fallback;
  return v.trim().slice(0, 80);
}
function sfx(kind){
  try{
    const ctx = new (window.AudioContext || window.webkitAudioContext)();
    const o = ctx.createOscillator(), g = ctx.createGain();
    const now = ctx.currentTime, freq = { error:180, whoosh:420, tada:880, confirm:520 }[kind] || 600;
    o.type='sine'; o.frequency.setValueAtTime(freq, now);
    g.gain.setValueAtTime(0.0001, now);
    g.gain.exponentialRampToValueAtTime(0.2, now + 0.02);
    g.gain.exponentialRampToValueAtTime(0.0001, now + 0.15);
    o.connect(g); g.connect(ctx.destination); o.start(); o.stop(now + 0.16);
  }catch(e){}
}

// ×”×¦×’ ×¡×˜×˜×•×¡Ö¾×‘×¨ ×¨×§ ×‘×¤×¨×™×‘×™×•
if (PREV) document.getElementById('status').style.display = 'flex';

function el(html){ document.getElementById('app').innerHTML = html; }

// ===== Voice Verify (placeholder ×¢×“ ×œ××™××•×©) =====
function voiceVerify(){
el(`
<div class="badge">Voice Verify â€“ demo</div>
<h1 class="h1">${NAME}, a special gift is waiting! ğŸ</h1>
<p class="p">Fun verification challenge.</p>
<button class="btn btn-primary">Verify & get the gift</button>
<p class="p" style="margin-top:12px">Gift link (hidden in real flow): <a href="${GIFT}" target="_blank">${GIFT}</a></p>
`);
}

// ===== Fake Captcha =====
function captcha(){
  const qs    = new URLSearchParams(location.search);
  const PREV  = (qs.get('preview')||'0').trim()==='1';
  const NAME  = (qs.get('name')||'Friend').trim();
  const GIFT  = (qs.get('giftUrl')||'#').trim();

  const copy = {
    introTitle:  (qs.get('introTitle') || `Hey ${NAME}!`).slice(0,80),
    introSub:    (qs.get('introSub')   || `Before your gift, quick verification.`).slice(0,80),
    introBtn:    (qs.get('introBtn')   || `Start`).slice(0,32),
    gridHeader:  (qs.get('gridHeader') || `Select all images with the CREEP`).slice(0,80),
    verify:      (qs.get('verifyText') || `Verify`).slice(0,32),
    continueTxt: (qs.get('continueText') || `Continue`).slice(0,32),
    okTitle:     (qs.get('okTitle')    || `Verified!`).slice(0,80),
    okSub:       (qs.get('okSub')      || `Youâ€™re good to go.`).slice(0,80),
    okBtn:       (qs.get('okBtn')      || `Get the gift`).slice(0,32),
  };

  // ×©×œ×•×©×ª ×”×™×¢×“×™× ×”×§×‘×•×¢×™×: 0..8 â†’ [×™×× ×™â€‘×¢×œ×™×•×Ÿ, ××¨×›×–, ××¨×›×–â€‘×ª×—×ª×•×Ÿ]
  const targets = [2,4,7];  // 3Ã—3 grid indices. Fixed by brief.  :contentReference[oaicite:7]{index=7}

  // ×§×œ×˜ ××”â€‘URL (×¡×“×¨ ×§×•×‘×¢: img1â†’×™×¢×“ ×¨××©×•×Ÿ, img2â†’×™×¢×“ ×©× ×™, img3â†’×™×¢×“ ×©×œ×™×©×™)
  const IMG_URLS = [ qs.get('img1')||'', qs.get('img2')||'', qs.get('img3')||'' ];
  const anyProvided = IMG_URLS.some(Boolean);

  // 6 ×”×ª××•× ×•×ª ×”×§×‘×•×¢×•×ª ×œ×¨×™×‘×•×¢×™× ×©××™× × ×™×¢×“×™× (×œ×¤×™ ×¡×“×¨ ×”××™×§×•××™× ×”×œ×â€‘×™×¢×“×™×™×)
const FILLER_URLS = [
  "https://images.pexels.com/photos/1072179/pexels-photo-1072179.jpeg?auto=compress&cs=tinysrgb&w=600&h=600&dpr=2",
  "https://images.pexels.com/photos/113338/pexels-photo-113338.jpeg?auto=compress&cs=tinysrgb&w=600&h=600&dpr=2",
  "https://images.pexels.com/photos/38136/pexels-photo-38136.jpeg?auto=compress&cs=tinysrgb&w=600&h=600&dpr=2",
  "https://images.pexels.com/photos/70365/forest-sunbeams-trees-sunlight-70365.jpeg?auto=compress&cs=tinysrgb&w=600&h=600&dpr=2",
  "https://images.pexels.com/photos/1666021/pexels-photo-1666021.jpeg?auto=compress&cs=tinysrgb&w=600&h=600&dpr=2",
  "https://images.pexels.com/photos/1547813/pexels-photo-1547813.jpeg?auto=compress&cs=tinysrgb&w=600&h=600&dpr=2"
];

  // Placeholder "×ª××•× ×” ×œ×‘× ×” ×¢× ×˜×§×¡×˜": data:URI (SVG), ××™×Ÿ ×ª×œ×•×ª ×—×™×¦×•× ×™×ª
function placeholderDataURL(){
  const svg =
    `<svg xmlns='http://www.w3.org/2000/svg' width='600' height='600'>
       <rect width='100%' height='100%' fill='white'/>
       <g fill='#111' font-family='system-ui,Segoe UI,Roboto,Helvetica,Arial' font-weight='700'>
         <text x='50%' y='45%' text-anchor='middle' font-size='56'>Your friend</text>
         <text x='50%' y='60%' text-anchor='middle' font-size='56'>goes here ğŸ¤£</text>
       </g>
     </svg>`;
  return 'data:image/svg+xml;charset=UTF-8,' + encodeURIComponent(svg);
  }
  const PLACEHOLDER = placeholderDataURL();
  function sizeForGrid(src){
  try{
    const u = new URL(src);
    // Cloudinary: ××•×¡×™×¤×™× ×˜×¨× ×¡×¤×•×¨××¦×™×” ×§×œ×” (600x600, ×—×™×ª×•×š, ××™×›×•×ª/×¤×•×¨××˜ ××•×˜×•)
    if (/res\.cloudinary\.com/.test(u.hostname)) {
      return src.replace('/upload/', '/upload/f_auto,q_auto,w_600,h_600,c_fill/');
    }
    // Pexels: ×× ×™×’×™×¢ ×§×™×©×•×¨ ×‘×œ×™ ×¤×¨××˜×¨×™×, × ×•×¡×™×£ ×œ×•
    if (/images\.pexels\.com/.test(u.hostname)) {
      u.searchParams.set('auto','compress');
      u.searchParams.set('cs','tinysrgb');
      u.searchParams.set('w','600'); u.searchParams.set('h','600');
      u.searchParams.set('dpr', (window.devicePixelRatio||1) > 1 ? '2' : '1');
      return u.toString();
    }
    return src;
  }catch(e){ return src; }
}
  
  // ×‘â€‘PREVIEW: ×× ×—×¡×¨×” ×ª××•× ×” ×œ×™×¢×“ ××¡×•×™× â†’ ××¦×™×’×™× placeholder.
  // ×‘×œ×™×™×‘: ×× ×¡×•×¤×§×• ×¤×—×•×ª ×â€‘3, × ×©×›×¤×œ ××ª ×”×§×™×™××•×ª ×›×“×™ ×œ××œ× ××ª ×©×œ×•×©×ª ×”×™×¢×“×™×.
  function getTargetSrc(slotIndex){ // slotIndex: 0..2 ×ª×•×× img1/img2/img3
    if (IMG_URLS[slotIndex]) return IMG_URLS[slotIndex];
    if (PREV || !anyProvided) return PLACEHOLDER;
    // ×œ×™×™×‘ ×¢× 1â€“2 ×ª××•× ×•×ª: ×©×›×¤×•×œ ×××•×–×Ÿ
    const present = IMG_URLS.filter(Boolean);
    return present[(slotIndex % present.length)] || PLACEHOLDER;
  }

  // ××™×¤×•×™ ×”××™×§×•××™× ×©××™× × ×™×¢×“×™× â†’ 6 ×”×ª××•× ×•×ª ×”×§×‘×•×¢×•×ª ×œ×¤×™ ×¡×“×¨
  const nonTargets = [0,1,3,5,6,8];

  const app = document.getElementById('app');
  app.classList.remove('card'); // ×ª×•×× infinite â€“ ××¡×š â€œ× ×§×™â€  :contentReference[oaicite:8]{index=8}

  function screenIntro(){
    app.innerHTML = `
      <div class="wrap wrap-captcha">
        <h1 class="cap-title">${copy.introTitle}</h1>
        <p class="cap-sub">${copy.introSub}</p>
        <button id="start" class="btn cap-cta">${copy.introBtn}</button>
        <div class="cap-hint">Prank simulation â€¢ demo only â€¢ no data collected</div>
      </div>
    `;
    document.getElementById('start').addEventListener('click', ()=>{ try{sfx('confirm')}catch(e){}; screenGrid(); });
  }

  function tileHtml(i){
    // ×™×¢×“?
    const ti = targets.indexOf(i);
    if (ti !== -1){
      const src = getTargetSrc(ti);
      return `<div class="cap-tile" data-i="${i}"><img class="cap-img" src="${src}" alt=""></div>`;
      const src = sizeForGrid(getTargetSrc(ti));
return `<div class="cap-tile" data-i="${i}"><img class="cap-img" src="${src}" alt="" decoding="async"></div>`;
    }
    // ×œ× ×™×¢×“ â†’ ×ª××•× ×ª Pexels ×§×‘×•×¢×” ×œ×¤×™ ×¡×“×¨ nonTargets
    const k = nonTargets.indexOf(i);
    const src = FILLER_URLS[k] || PLACEHOLDER;
    return `<div class="cap-tile" data-i="${i}"><img class="cap-img" src="${src}" alt=""></div>`;
    const src = sizeForGrid(FILLER_URLS[k] || PLACEHOLDER);
return `<div class="cap-tile" data-i="${i}"><img class="cap-img" src="${src}" alt="" decoding="async"></div>`;
  }

  function screenGrid(){
    app.innerHTML = `
      <div class="wrap wrap-captcha">
        <h1 class="cap-title">${copy.gridHeader}</h1>
        <div id="grid" class="cap-grid">
          ${Array.from({length:9}).map((_,i)=>tileHtml(i)).join('')}
        </div>
        <button id="verify" class="btn cap-cta">${copy.verify}</button>
        ${PREV ? `<div class="cap-hint">Preview mode</div>` : ``}
        <canvas id="cap-confetti" class="confetti-canvas"></canvas>
      </div>
    `;

    const grid = document.getElementById('grid');
    const verifyBtn = document.getElementById('verify');
    const confettiCanvas = document.getElementById('cap-confetti');

grid.addEventListener('pointerdown', (e)=>{
  const tile = e.target.closest('.cap-tile');
  if(!tile) return;
  tile.classList.toggle('sel');
    });

    let solved = false;

    verifyBtn.addEventListener('click', ()=>{
      if(solved){ screenSuccess(); return; }
      const selected = [...grid.querySelectorAll('.cap-tile.sel')].map(t=>+t.dataset.i).sort((a,b)=>a-b);
      const ok = JSON.stringify(selected) === JSON.stringify([...targets].sort((a,b)=>a-b)); // ×‘×“×™×•×§ 3 ×”×™×¢×“×™×  :contentReference[oaicite:9]{index=9}
      if(!ok){
        try{sfx('error')}catch(e){}
        verifyBtn.classList.add('error'); grid.classList.add('shake');
        setTimeout(()=>{ verifyBtn.classList.remove('error'); grid.classList.remove('shake'); }, 380);
        return;
      }
      try{sfx('tada')}catch(e){}
      confettiBurst(confettiCanvas);
      verifyBtn.textContent = copy.continueTxt;
      verifyBtn.classList.add('green');
      solved = true;
    });
  }

  function screenSuccess(){
    app.innerHTML = `
      <div class="wrap wrap-captcha">
        <h1 class="cap-title">${copy.okTitle}</h1>
        <p class="cap-sub">${copy.okSub}</p>
        <button id="openGift" class="btn cap-cta green">${copy.okBtn}</button>
        ${PREV ? `<div class="cap-hint">Preview only â€” button disabled</div>` : ``}
      </div>
    `;
    const btn = document.getElementById('openGift');
    btn.addEventListener('click', ()=>{
      if(PREV) return; // ×‘×¤×¨×™×‘×™×• ×œ× ×¤×•×ª×—×™× ××ª× ×”
      try{sfx('confirm')}catch(e){}
      try{ window.open(GIFT, '_blank', 'noopener'); }catch(e){}
    });
  }

  // ×§×•× ×¤×˜×™ ×§×˜×Ÿ
  function confettiBurst(canvas){
    if(!canvas) return;
    const ctx = canvas.getContext('2d');
    const r = window.devicePixelRatio || 1;
    function size(){ canvas.width = canvas.clientWidth * r; canvas.height = canvas.clientHeight * r; ctx.setTransform(r,0,0,r,0,0); }
    if(!canvas.__sized){ canvas.__sized = true; canvas.style.display='block'; size(); window.addEventListener('resize', size); }
    const colors = ['#a78bfa','#60a5fa','#34d399','#f472b6','#f59e0b'];
    const pieces = [];
    const w = canvas.clientWidth, h = canvas.clientHeight;
    for(let i=0;i<120;i++){
      pieces.push({ x:w/2, y:h/2, vx:(Math.random()*4-2), vy:(Math.random()*-3-2),
        r:Math.random()*6+3, c:colors[(Math.random()*colors.length)|0], a:1, spin:(Math.random()*6.28), vr:(Math.random()*0.2-0.1) });
    }
    const g = 0.05; let t=0;
    (function step(){
      ctx.clearRect(0,0,w,h);
      pieces.forEach(p=>{
        p.vy += g; p.x += p.vx; p.y += p.vy; p.spin += p.vr; p.a -= 0.008;
        ctx.globalAlpha = Math.max(p.a,0);
        ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(p.spin);
        ctx.fillStyle = p.c; ctx.fillRect(-p.r/2,-p.r/2,p.r,p.r);
        ctx.restore();
      });
      ctx.globalAlpha = 1;
      if(t++<260) requestAnimationFrame(step); else ctx.clearRect(0,0,w,h);
    })();
  }

  // GO
  screenIntro();
}

// ===== Infinite Buttons =====
function infinite(){
  const app = document.getElementById('app');

  // Read params
  const NAME = getCopy('name', 'Friend');
  const GIFT = qs.get('giftUrl') || 'https://example.com';
  const ACCENT = (qs.get('accent') || 'dark').toLowerCase();
  const titleOverride = qs.get('title');

  const copy = {
    title: titleOverride ? titleOverride : `${NAME}, you've got a sweet surprise! ğŸ’–`,
    subtitle: getCopy('subtitle', 'Click the button to get your gift'),
    btn1_loading: getCopy('btn1_loading', 'Checking your surpriseâ€¦'),
    btn2_error: getCopy('btn2_error', 'Oops! Try again'),
    btn3_tease1: getCopy('btn3_tease1', 'Hmmâ€¦ almost ğŸ˜‰'),
    btn4_tease2: getCopy('btn4_tease2', 'Keep goingâ€¦'),
    btn5_tease3: getCopy('btn5_tease3', 'Patience, hero!'),
    btn6_tease4: getCopy('btn6_tease4', 'So closeâ€¦'),
    btn7_tease5: getCopy('btn7_tease5', 'Last one!'),
    btn8_success: getCopy('btn8_success', 'Unlocked! Tap to open'),
    earned: getCopy('earned', 'You earned it ğŸ‰')
  };

  // Inner block
  const inner = document.createElement('div');
  inner.className = 'wrap wrap-infinite';
  inner.innerHTML = `
    <h1>${copy.title}</h1>
    <p class="sub">${copy.subtitle}</p>

    <button id="ibtn" class="btn">
      <span id="ilabel" class="label">${getCopy('btn0_start','Click to get your gift')}</span>
      <span id="ipct" class="percent" style="display:none">0%</span>
    </button>

    <div id="iprogress" class="progress" aria-hidden="true" style="display:none">
      <div class="progress__bar" id="ibar"></div>
    </div>

    <div id="earned" class="earned">${copy.earned}</div>
    <canvas id="confetti" class="confetti-canvas"></canvas>
  `;
  app.replaceChildren(inner);
  document.getElementById('app').classList.remove('card');

  // Refs
  const btn = document.getElementById('ibtn');
  const ilabel = document.getElementById('ilabel');
  const ipct = document.getElementById('ipct');
  const bar = document.getElementById('ibar');
  const progWrap = document.getElementById('iprogress');
  const earned = document.getElementById('earned');
  const confettiCanvas = document.getElementById('confetti');

  // helpers for fun states
  function resetBtnColors(){
    btn.classList.remove('error','purple','sky','green','alt1','alt2','success');
  }
  function resetFx(){
    inner.classList.remove('shake','fx-alert','fx-calm','fx-blue','fx-pink');
  }

  // state
  let tap = 0;
  let loading = false;
  let success = false;
  btn.disabled = false;
  let interval = null;

  function startLoading(){
    loading = true;
    btn.disabled = true;
    sfx('confirm');

    progWrap.style.display = 'block';
    ipct.style.display = 'inline';
    ipct.textContent = '0%';
    bar.style.width = '0%';

    let p = 0;
    interval = setInterval(()=>{
      p = Math.min(100, p + Math.floor(Math.random()*7)+2);
      bar.style.width = p + '%';
      ipct.textContent = p + '%';

      if (p >= 100){
        clearInterval(interval);
        setTimeout(()=>{
  ipct.style.display = 'none';
  btn.disabled = false;
  loading = false;
  // ××¢×‘×¨ ××•×˜×•××˜×™ ×œ×©×œ×‘ ×”×‘× (Oops) ×‘×œ×™ ×§×œ×™×§ × ×•×¡×£
  if (tap === 1) { btn.click(); }
}, 300);
      }
    }, 120);
  }

  function openGift(){
    try { window.open(GIFT, '_blank', 'noopener'); } catch(e) {}
  }

  btn.addEventListener('click', function(){
    if (success) { openGift(); return; }

    if (tap === 0){
      ilabel.textContent = copy.btn1_loading;
      if (!interval) startLoading();
      tap = 1;
      return;
    }
    if (loading) return;

    tap++;

    switch (tap) {
      case 2: {
        ilabel.textContent = copy.btn2_error;
        resetBtnColors(); btn.classList.add('error'); sfx('error');
        inner.classList.add('shake'); setTimeout(()=> inner.classList.remove('shake'), 300);
        break;
      }
      case 3: {
  ilabel.textContent = copy.btn3_tease1;
  resetBtnColors(); btn.classList.add('alt1'); resetFx();
  inner.classList.add('shake'); setTimeout(()=> inner.classList.remove('shake'), 300);
  break;
}
      case 4: {
  ilabel.textContent = copy.btn4_tease2;
  resetBtnColors(); btn.classList.add('alt2'); resetFx();
  break;
}
      case 5: {
  ilabel.textContent = copy.btn5_tease3;
  resetBtnColors(); btn.classList.add('alt1'); resetFx();
  sfx('whoosh');
  break;
}
      case 6: {
  ilabel.textContent = copy.btn6_tease4;
  resetBtnColors(); btn.classList.add('alt2'); resetFx();
  break;
}
      case 7: {
  ilabel.textContent = copy.btn7_tease5;
  resetBtnColors(); btn.classList.add('alt1'); resetFx();
  sfx('whoosh');
  break;
}
      case 8: {
        ilabel.textContent = copy.btn8_success;
        resetBtnColors(); btn.classList.add('green'); // ××• .success ×× ×”×•×¡×¤×ª CSS
        earned.classList.add('show');
        confettiBurst(confettiCanvas);
        sfx('tada');
        success = true;
        break;
      }
      default: {
        openGift();
      }
    }
  }, false);

  // Canvas confetti (modern "poof")
  function confettiBurst(canvas){
    if (!canvas) return;
    const ctx = canvas.getContext('2d');
    const r = window.devicePixelRatio || 1;
    function size(){ canvas.width = canvas.clientWidth * r; canvas.height = canvas.clientHeight * r; ctx.setTransform(r,0,0,r,0,0); }
    if (!canvas.__sized){ canvas.__sized = true; canvas.style.display='block'; size(); window.addEventListener('resize', size); }
    const colors = ['#a78bfa','#60a5fa','#34d399','#f472b6','#f59e0b'];
    const pieces = [];
    const w = canvas.clientWidth, h = canvas.clientHeight;
    for(let i=0;i<120;i++){
      pieces.push({ x:w/2, y:h/2, vx:(Math.random()*4-2), vy:(Math.random()*-3-2),
        r:Math.random()*6+3, c:colors[(Math.random()*colors.length)|0], a:1, spin:(Math.random()*6.28), vr:(Math.random()*0.2-0.1) });
    }
    const g = 0.05; let t=0;
    (function step(){
      ctx.clearRect(0,0,w,h);
      pieces.forEach(p=>{
        p.vy += g; p.x += p.vx; p.y += p.vy; p.spin += p.vr; p.a -= 0.008;
        ctx.globalAlpha = Math.max(p.a,0);
        ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(p.spin);
        ctx.fillStyle = p.c; ctx.fillRect(-p.r/2,-p.r/2,p.r,p.r);
        ctx.restore();
      });
      ctx.globalAlpha = 1;
      if(t++<260) requestAnimationFrame(step); else ctx.clearRect(0,0,w,h);
    })();
  }
}
// ===== Narcissist Questions =====
function narcissistQ(){
el(`
<div class="badge">Narcissist Q â€“ demo</div>
<h1 class="h1">Quick personality check for ${NAME}</h1>
<p class="p">Answer a few oddly self-centric questionsâ€¦</p>
<button class="btn btn-primary">Start</button>
`);
}

// ===== Selfie Verify =====
function selfieVerify(){
el(`
<div class="badge">Selfie Verify â€“ demo</div>
<h1 class="h1">${NAME}, snap a quick selfie ğŸ“¸</h1>
<p class="p">This is a demo screen. Real flow will ask for permissions.</p>
<button class="btn btn-primary">Open camera</button>
`);
}

const map = {
'voice-verify': voiceVerify,
'captcha': captcha,
'infinite': infinite,
'narcissist-q': narcissistQ,
'selfie-verify': selfieVerify
};

(map[F] || (()=>el('<h1 class="h1">Feature not found</h1><p class="p">Use ?f=voice-verify|captcha|infinite|narcissist-q|selfie-verify</p>')))();
})();
</script>
